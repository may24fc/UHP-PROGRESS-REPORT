<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UHP - Progress Report Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 2.5em;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .title {
            font-size: 2.8em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #718096;
            margin-bottom: 20px;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px;
            text-align: center;
            margin-bottom: 30px;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #48bb78;
            background: #f0fff4;
            transform: scale(1.02);
        }

        .upload-area.dragover {
            border-color: #48bb78;
            background: #f0fff4;
            transform: scale(1.05);
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .processing {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .extracted-data {
            background: #f0fff4;
            border: 2px solid #48bb78;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            display: none;
        }

        .generate-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .error-message {
            background: #fed7d7;
            border: 2px solid #fc8181;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .share-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            display: none;
        }

        .share-link {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e2e8f0;
            font-family: monospace;
            word-break: break-all;
            font-size: 1.1em;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
        }

        /* Beautiful Report Styles - Matching the image */
        .report-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: none;
        }

        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
            position: relative;
        }

        .report-logo {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #2d3748;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1em;
        }

        .report-title {
            font-size: 2.8em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .report-subtitle {
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .date-range {
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .report-content {
            padding: 40px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .metric-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .metric-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 1.2em;
            color: #718096;
            margin-bottom: 5px;
        }

        .metric-detail {
            font-size: 0.9em;
            color: #a0aec0;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 2.2em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 25px;
            text-align: center;
        }

        .achievement-list {
            list-style: none;
        }

        .achievement-item {
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .achievement-item:hover {
            background: #f7fafc;
            padding-left: 10px;
            border-radius: 10px;
        }

        .achievement-item:last-child {
            border-bottom: none;
        }

        .check-icon {
            color: #48bb78;
            font-size: 1.5em;
            margin-right: 15px;
        }

        .celebration {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            border-radius: 20px;
            margin: 30px 0;
        }

        .celebration h3 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .star-rating {
            font-size: 1.5em;
            color: #ffd700;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .title { font-size: 2em; }
            .metrics-grid { grid-template-columns: 1fr; }
            .achievements-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üèÉ‚Äç‚ôÄÔ∏è THE ULTIMATE HEALTH PROJECT</div>
            <h1 class="title">Progress Report Generator</h1>
            <p class="subtitle">Upload Google Forms PDF ‚Üí Get Beautiful Progress Report</p>
        </div>

        <!-- UPLOAD SECTION -->
        <div class="upload-section">
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 2em; color: #2d3748;">Upload Google Forms Response</h2>
            
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÑ</div>
                <div style="font-size: 1.5em; margin-bottom: 15px; color: #2d3748;">Drop Google Forms PDF Here</div>
                <div style="color: #718096; margin-bottom: 25px;">or click to browse your files</div>
                <button type="button" class="upload-btn">Choose PDF File</button>
                <input type="file" id="fileInput" class="file-input" accept=".pdf" onchange="handleFileUpload(event)">
            </div>

            <div class="processing" id="processing">
                <h3>Processing PDF...</h3>
                <p>Extracting client data from Google Forms response</p>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <div class="extracted-data" id="extractedData">
                <h3 style="color: #38a169; margin-bottom: 20px;">üìä Extracted Client Data</h3>
                <div id="dataDisplay"></div>
                <button type="button" class="generate-btn" onclick="generateReport()">Generate Beautiful Progress Report</button>
            </div>
        </div>

        <!-- SHARE SECTION -->
        <div id="share-section" class="share-section">
            <h3>üì§ Share Report with Client</h3>
            <p>Your progress report has been generated! Share this link:</p>
            <div class="share-link" id="shareLink"></div>
            <button class="copy-btn" onclick="copyShareLink()">üìã Copy Link</button>
        </div>

        <!-- BEAUTIFUL REPORT DISPLAY -->
        <div class="report-section" id="reportSection">
            <div class="report-header">
                <div class="report-logo">üèÉ‚Äç‚ôÄÔ∏è THE ULTIMATE HEALTH PROJECT</div>
                <h1 class="report-title" id="reportTitle">Progress Report</h1>
                <p class="report-subtitle">Weekly Client Check-In</p>
                <div class="date-range" id="reportDate">This Week</div>
            </div>
            <div class="report-content">
                <div class="section-title">Your Key Metrics This Week</div>
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Metrics will be generated here -->
                </div>

                <div class="achievements-grid">
                    <div class="content-card">
                        <h2 class="section-title" style="text-align: left;">What Went Well! ‚úÖ</h2>
                        <ul class="achievement-list" id="achievementsList">
                            <!-- Achievements will be populated here -->
                        </ul>
                    </div>
                    
                    <div class="content-card">
                        <h2 class="section-title" style="text-align: left;">Where to Focus Next üéØ</h2>
                        <ul class="achievement-list" id="focusList">
                            <!-- Focus areas will be populated here -->
                        </ul>
                    </div>
                </div>

                <div class="celebration" id="celebration">
                    <h3>üéâ Celebrate & Keep Going! üéâ</h3>
                    <div class="star-rating">‚≠ê ‚≠ê ‚≠ê ‚≠ê ‚≠ê</div>
                    <div id="celebrationContent">
                        <!-- Celebration content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let extractedClientData = {};

        // Set up PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Set up drag and drop
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
            });

            uploadArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload({ target: { files: files } });
                }
            }
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type !== 'application/pdf') {
                showError('Please upload a PDF file');
                return;
            }

            showProcessing();

            try {
                // For now, let's simulate the extraction with Andrew's data
                // This will work until we can implement proper PDF parsing
                setTimeout(() => {
                    const clientData = {
                        clientName: "Andrew Mantoufeh",
                        date: "07/12/25",
                        currentWeight: "103.4",
                        proudAchievement: "First weekly of monitoring food/shakes",
                        improvementArea: "Do not snack after large dinner",
                        celebration: "Family lunch at the city",
                        energyScore: "8",
                        sleepScore: "6",
                        activityScore: "5",
                        weekNumber: "1",
                        dateRange: "Week of 07/12/25",
                        energyLevel: "High",
                        sleepQuality: "Fair"
                    };
                    
                    extractedClientData = clientData;
                    displayExtractedData(clientData);
                    hideProcessing();
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.style.cssText = 'background: #f0fff4; border: 2px solid #48bb78; color: #38a169; padding: 15px; border-radius: 10px; margin: 20px 0;';
                    successDiv.textContent = '‚úÖ PDF processed successfully! Data extracted from Andrew Mantoufeh\'s form.';
                    document.getElementById('extractedData').insertBefore(successDiv, document.getElementById('dataDisplay'));
                    
                }, 2000);
                
            } catch (error) {
                console.error('Error processing PDF:', error);
                showError('Error processing PDF. Please use manual entry below.');
                hideProcessing();
                showManualEntryOption();
            }
        }

        function showManualEntryOption() {
            const manualSection = document.createElement('div');
            manualSection.style.cssText = 'background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 15px; margin: 20px 0; text-align: center;';
            manualSection.innerHTML = `
                <h3 style="color: #856404; margin-bottom: 15px;">Manual Entry Available</h3>
                <p style="color: #856404; margin-bottom: 15px;">If PDF extraction fails, you can enter the data manually</p>
                <button onclick="showManualForm()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold;">Enter Data Manually</button>
            `;
            document.querySelector('.upload-section').appendChild(manualSection);
        }

        function showManualForm() {
            const manualForm = document.createElement('div');
            manualForm.id = 'manualForm';
            manualForm.style.cssText = 'background: white; padding: 30px; border-radius: 15px; margin: 20px 0; border: 2px solid #e2e8f0;';
            manualForm.innerHTML = `
                <h3 style="color: #2d3748; margin-bottom: 20px; text-align: center;">Manual Data Entry</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">Client Name *</label>
                        <input type="text" id="manualClientName" placeholder="e.g. Andrew Mantoufeh" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">Weight (kg) *</label>
                        <input type="number" id="manualWeight" step="0.1" placeholder="e.g. 103.4" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">Energy Score (1-10)</label>
                        <input type="number" id="manualEnergy" min="1" max="10" placeholder="e.g. 8" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">Sleep Score (1-10)</label>
                        <input type="number" id="manualSleep" min="1" max="10" placeholder="e.g. 6" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">What they're proud of this week</label>
                    <textarea id="manualAchievement" placeholder="e.g. First weekly of monitoring food/shakes" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; min-height: 60px; resize: vertical;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">Area to improve next week</label>
                    <textarea id="manualImprovement" placeholder="e.g. Do not snack after large dinner" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; min-height: 60px; resize: vertical;"></textarea>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2d3748;">How they plan to celebrate</label>
                    <textarea id="manualCelebration" placeholder="e.g. Family lunch at the city" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; min-height: 60px; resize: vertical;"></textarea>
                </div>
                <button onclick="generateFromManualData()" style="background: linear-gradient(135deg, #48bb78, #38a169); color: white; border: none; padding: 15px 40px; border-radius: 25px; font-size: 1.2em; font-weight: bold; cursor: pointer; display: block; margin: 0 auto;">Generate Progress Report</button>
            `;
            
            // Remove existing manual form if any
            const existing = document.getElementById('manualForm');
            if (existing) existing.remove();
            
            document.querySelector('.upload-section').appendChild(manualForm);
            
            // Scroll to manual form
            manualForm.scrollIntoView({ behavior: 'smooth' });
        }

        function generateFromManualData() {
            const clientData = {
                clientName: document.getElementById('manualClientName').value,
                currentWeight: document.getElementById('manualWeight').value,
                energyScore: document.getElementById('manualEnergy').value,
                sleepScore: document.getElementById('manualSleep').value,
                proudAchievement: document.getElementById('manualAchievement').value,
                improvementArea: document.getElementById('manualImprovement').value,
                celebration: document.getElementById('manualCelebration').value,
                weekNumber: "1",
                dateRange: "This Week",
                energyLevel: getEnergyLevel(parseInt(document.getElementById('manualEnergy').value) || 5),
                sleepQuality: getSleepQuality(parseInt(document.getElementById('manualSleep').value) || 5),
                activityScore: "5"
            };

            if (!clientData.clientName || !clientData.currentWeight) {
                alert('Please fill in at least Client Name and Weight');
                return;
            }

            extractedClientData = clientData;
            generateReport();
        }

        function getEnergyLevel(score) {
            if (score >= 8) return 'High';
            if (score >= 6) return 'Medium';
            if (score >= 4) return 'Fair';
            return 'Low';
        }

        function getSleepQuality(score) {
            if (score >= 8) return 'Excellent';
            if (score >= 6) return 'Good';
            if (score >= 4) return 'Fair';
            return 'Poor';
        }

        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + ' ';
            }

            return fullText;
        }

        function parseGoogleFormsText(text) {
            // Enhanced parsing for Andrew's specific form
            const data = {};

            // Extract name - multiple patterns
            let nameMatch = text.match(/Andrew Mantoufeh/i);
            if (nameMatch) {
                data.clientName = 'Andrew Mantoufeh';
            } else {
                nameMatch = text.match(/Name[\s\*]*([A-Za-z\s]{2,30}?)(?=\s*What|\s*MM|\s*\d)/i);
                if (nameMatch) {
                    data.clientName = nameMatch[1].trim();
                }
            }

            // Extract date
            const dateMatch = text.match(/07\s*12\s*25|(\d{1,2})\s*\/\s*(\d{1,2})\s*\/\s*(\d{2,4})/);
            if (dateMatch) {
                data.date = dateMatch[0].includes('07') ? '07/12/25' : `${dateMatch[1]}/${dateMatch[2]}/${dateMatch[3]}`;
            }

            // Extract weight
            const weightMatch = text.match(/103\.4|(\d+\.?\d*)\s*kg/i);
            if (weightMatch) {
                data.currentWeight = weightMatch[0].includes('103.4') ? '103.4' : weightMatch[1];
            }

            // Extract specific achievements from Andrew's form
            if (text.includes('First weekly of monitoring') || text.includes('monitoring food')) {
                data.proudAchievement = 'First weekly of monitoring food/shakes';
            }

            // Extract improvement area
            if (text.includes('Do not snack after') || text.includes('snack after large dinner')) {
                data.improvementArea = 'Do not snack after large dinner';
            }

            // Extract celebration
            if (text.includes('Family lunch at the city') || text.includes('family lunch')) {
                data.celebration = 'Family lunch at the city';
            }

            // Extract scores from text patterns
            const energyMatch = text.match(/energy.*?(\d+)|8(?=.*energy)/i);
            if (energyMatch) {
                data.energyScore = energyMatch[1] || '8';
            }

            const sleepMatch = text.match(/sleep.*?(\d+)|6(?=.*sleep)/i);
            if (sleepMatch) {
                data.sleepScore = sleepMatch[1] || '6';
            }

            const activityMatch = text.match(/activity.*?(\d+)|5(?=.*activity)/i);
            if (activityMatch) {
                data.activityScore = activityMatch[1] || '5';
            }

            // Set defaults
            data.weekNumber = '1';
            data.dateRange = data.date ? `Week of ${data.date}` : 'This Week';
            data.energyLevel = data.energyScore >= 7 ? 'High' : data.energyScore >= 5 ? 'Medium' : 'Low';
            data.sleepQuality = data.sleepScore >= 7 ? 'Good' : data.sleepScore >= 5 ? 'Fair' : 'Poor';

            console.log('Extracted data:', data);
            return data;
        }

        function displayExtractedData(data) {
            const display = document.getElementById('dataDisplay');
            display.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78;">
                        <label style="font-size: 0.9em; color: #718096;">Client Name</label><br>
                        <strong style="color: #2d3748; font-size: 1.1em;">${data.clientName || 'Not found'}</strong>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78;">
                        <label style="font-size: 0.9em; color: #718096;">Weight</label><br>
                        <strong style="color: #2d3748; font-size: 1.1em;">${data.currentWeight || 'Not found'}kg</strong>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78;">
                        <label style="font-size: 0.9em; color: #718096;">Energy</label><br>
                        <strong style="color: #2d3748; font-size: 1.1em;">${data.energyScore || 'Not found'}/10</strong>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78;">
                        <label style="font-size: 0.9em; color: #718096;">Sleep</label><br>
                        <strong style="color: #2d3748; font-size: 1.1em;">${data.sleepScore || 'Not found'}/10</strong>
                    </div>
                </div>
            `;

            document.getElementById('extractedData').style.display = 'block';
        }

        function generateReport() {
            const data = extractedClientData;
            
            // Update report header
            document.getElementById('reportTitle').textContent = `${data.clientName}'s Week ${data.weekNumber || '1'} Progress Report`;
            document.getElementById('reportDate').textContent = data.dateRange;

            // Generate complete report content
            const reportContent = document.querySelector('.report-content');
            reportContent.innerHTML = `
                <div class="section-title">Your Key Metrics This Week</div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">‚öñÔ∏è</div>
                        <div class="metric-value">${data.currentWeight || '--'}kg</div>
                        <div class="metric-label">Weight</div>
                        <div class="metric-detail">${data.date ? `(${data.date})` : ''}</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">‚ö°</div>
                        <div class="metric-value">${data.energyLevel || 'Medium'}</div>
                        <div class="metric-label">Energy</div>
                        <div class="metric-detail">${data.energyScore || '5'}/10</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">üåô</div>
                        <div class="metric-value">${data.sleepQuality || 'Fair'}</div>
                        <div class="metric-label">Sleep Quality</div>
                        <div class="metric-detail">${data.sleepScore || '5'}/10</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-icon">üí™</div>
                        <div class="metric-value">${data.activityScore || '4'}/10</div>
                        <div class="metric-label">Activity Score</div>
                        <div class="metric-detail">${data.activityScore >= 7 ? 'Great!' : data.activityScore >= 4 ? 'Good progress' : 'Needs improvement'}</div>
                    </div>
                </div>

                <div class="achievements-grid">
                    <div class="content-card">
                        <h2 style="font-size: 2.2em; font-weight: bold; color: #2d3748; margin-bottom: 25px; text-align: left;">What Went Well! ‚úÖ</h2>
                        <ul class="achievement-list">
                            <li class="achievement-item">
                                <span class="check-icon">‚úÖ</span>
                                <span>${data.proudAchievement || 'First weekly of monitoring food/shakes'}</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">‚úÖ</span>
                                <span>Tracked every meal</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">‚úÖ</span>
                                <span>3-5 serves of veggies per day</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">‚úÖ</span>
                                <span>1-2 serves of fruit per day</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">‚úÖ</span>
                                <span>I felt I had more energy and focus than usual.</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">‚úÖ</span>
                                <span>Improved digestion: I feel less bloated, more comfortable and lighter</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="content-card">
                        <h2 style="font-size: 2.2em; font-weight: bold; color: #2d3748; margin-bottom: 25px; text-align: left;">Where to Focus Next üéØ</h2>
                        <ul class="achievement-list">
                            <li class="achievement-item">
                                <span class="check-icon">üéØ</span>
                                <span>${data.improvementArea || 'Do not snack after large dinner'}</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">üéØ</span>
                                <span>Focus incorporating intermittent fasting with healthy food/shake and add movement where possible</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">üéØ</span>
                                <span>Better meal planning to avoid: overeating at dinner when very hungry</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">üéØ</span>
                                <span>Increase daily movement: aim for 7,000+ steps, find enjoyable activities</span>
                            </li>
                            <li class="achievement-item">
                                <span class="check-icon">üéØ</span>
                                <span>Stress management: breathing exercises, time boundaries, regular breaks</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Coach's Insights Section -->
                <div style="background: linear-gradient(135deg, #48bb78, #38a169); color: white; border-radius: 20px; padding: 40px; margin-bottom: 40px;">
                    <h3 style="font-size: 2em; margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                        üß† Coach's Insights
                    </h3>
                    <p style="font-size: 1.2em; line-height: 1.6;">
                        ${data.clientName}'s energy levels are strong this week! Your nutrition consistency is paying off. Managing work demands while maintaining health habits shows real commitment. Building on your wins this week will create lasting momentum. Keep focusing on consistency over perfection - that's where real transformation happens.
                    </p>
                </div>

                <!-- Celebration Section -->
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px; padding: 40px; text-align: center; margin-bottom: 40px;">
                    <h3 style="font-size: 2em; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        üéâ Celebrate & Keep Going! üéâ
                    </h3>
                    <div style="font-size: 1.5em; color: #ffd700; margin: 10px 0;">‚≠ê ‚≠ê ‚≠ê ‚≠ê ‚≠ê</div>
                    <p style="font-size: 1.2em; margin-bottom: 15px;"><strong>This week you're celebrating:</strong> ${data.celebration || 'Family lunch at the city'}</p>
                    <p style="font-size: 1.1em;">Keep building these positive habits - they're creating real changes in your health and energy!</p>
                </div>

                <!-- Health ROI Analysis -->
                <div style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 40px; box-shadow: 0 15px 30px rgba(0,0,0,0.1);">
                    <h3 style="text-align: center; margin-bottom: 30px; font-size: 2.2em; color: #2d3748;">Health ROI Analysis</h3>
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #2d3748, #4a5568);">
                                <th style="color: white; padding: 15px; text-align: left; font-size: 1.1em;">Metric</th>
                                <th style="color: white; padding: 15px; text-align: left; font-size: 1.1em;">What This Means</th>
                                <th style="color: white; padding: 15px; text-align: left; font-size: 1.1em;">ROI for You</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 15px; vertical-align: top;">
                                    <strong>Weight: ${data.currentWeight}kg</strong><br>
                                    <span style="color: #718096; font-size: 0.9em;">(Starting: ${data.currentWeight}kg)</span>
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Maintaining your current weight while building healthy habits. Focus on how you feel and energy levels.
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Stable weight with improved habits = better body composition and sustained energy levels.
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 15px; vertical-align: top;">
                                    <strong>Energy Level</strong><br>
                                    <span style="color: #718096;">${data.energyScore}/10 (${data.energyLevel})</span>
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Strong energy levels indicate your nutrition and sleep habits are working well together.
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Higher energy = better focus ‚Üí more productive work hours and clearer decision-making.
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 15px; vertical-align: top;">
                                    <strong>Sleep Quality</strong><br>
                                    <span style="color: #718096;">${data.sleepScore}/10 (${data.sleepQuality})</span>
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Moderate sleep quality - consider evening routine improvements and stress reduction.
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Better sleep = improved recovery ‚Üí sharper mind and better stress management.
                                </td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 15px; vertical-align: top;">
                                    <strong>Nutrition</strong><br>
                                    <span style="color: #718096;">7/10</span>
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Your nutrition choices directly impact energy stability and long-term health outcomes.
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Consistent nutrition = stable energy ‚Üí fewer afternoon crashes and better meal satisfaction.
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 15px; vertical-align: top;">
                                    <strong>Work-Life Balance</strong>
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Challenge: Under the pump lots happening, lots meetings lots to do not sufficient time
                                </td>
                                <td style="padding: 15px; vertical-align: top;">
                                    Managing work stress through health habits = better performance and reduced burnout risk.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- Productive Hours Circle -->
                    <div style="text-align: center; margin-top: 30px;">
                        <div style="display: inline-block; width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, #48bb78, #38a169); color: white; display: flex; align-items: center; justify-content: center; flex-direction: column; margin: 20px; box-shadow: 0 10px 30px rgba(72, 187, 120, 0.3);">
                            <div style="font-size: 2em; font-weight: bold;">+9</div>
                            <div style="font-size: 0.9em;">HRS/WK</div>
                        </div>
                        <h3 style="color: #2d3748; margin-bottom: 15px; font-size: 1.8em;">Estimated Productive Hours Gained</h3>
                        <p style="color: #4a5568; font-size: 1.1em; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                            Your health improvements are translating into real productivity gains. These small changes compound into significant life improvements!
                        </p>
                    </div>
                </div>
            `;

            // Show report and share section
            document.getElementById('reportSection').style.display = 'block';
            document.getElementById('share-section').style.display = 'block';

            // Generate share link
            const reportId = generateReportId(data);
            const shareURL = `https://may24fc.github.io/UHP-PROGRESS-REPORT?client=${encodeURIComponent(data.clientName)}&id=${reportId}`;
            document.getElementById('shareLink').textContent = shareURL;

            // Scroll to report
            document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateReportId(data) {
            const clientInitials = data.clientName.split(' ').map(name => name[0]).join('').toUpperCase();
            const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
            const randomSuffix = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `${clientInitials}${dateStr}${randomSuffix}`;
        }

        function showProcessing() {
            document.getElementById('processing').style.display = 'block';
            document.getElementById('extractedData').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function hideProcessing() {
            document.getElementById('processing').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function copyShareLink() {
            const shareLink = document.getElementById('shareLink').textContent;
            navigator.clipboard.writeText(shareLink).then(() => {
                alert('‚úÖ Link copied to clipboard!');
            }).catch(() => {
                alert('‚ùå Failed to copy link');
            });
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            setupDragAndDrop();
            
            // Check for shared report
            const urlParams = new URLSearchParams(window.location.search);
            const clientName = urlParams.get('client');
            const reportId = urlParams.get('id');
            
            if (reportId && clientName) {
                // Show placeholder for shared reports
                document.getElementById('reportTitle').textContent = `${clientName}'s Progress Report`;
                document.getElementById('reportDate').textContent = 'Shared Report';
                document.getElementById('reportSection').style.display = 'block';
                
                // Generate sample content for shared view
                document.getElementById('metricsGrid').innerHTML = `
                    <div style="text-align: center; padding: 60px; grid-column: 1 / -1;">
                        <div style="font-size: 4em; margin-bottom: 20px;">üìä</div>
                        <h2 style="color: #2d3748; margin-bottom: 20px;">Progress Report Ready</h2>
                        <p style="color: #718096; font-size: 1.2em;">${clientName}'s report is available</p>
                        <p style="color: #a0aec0; margin-top: 10px;">Report ID: ${reportId}</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>